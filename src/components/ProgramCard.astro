---
interface Props {
  id: string;
  name: string;
  category: string;
  area: string;
  description: string;
  whatTheyOffer?: string;
  howToGetIt?: string;
  phone?: string;
  link?: string;
  linkText?: string;
  groups?: string[];
  verifiedBy?: string;
  verifiedDate?: string;
}

const {
  id,
  name,
  category,
  area,
  description,
  whatTheyOffer,
  howToGetIt,
  phone,
  link,
  linkText = 'Learn More',
  groups = [],
  verifiedBy,
  verifiedDate,
} = Astro.props;

// Format verified date for display
const formatDate = (dateStr: string) => {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

// Category badge colors
const categoryColors: Record<string, string> = {
  'Food': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
  'Health': 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
  'Housing': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
  'Utilities': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
  'Transportation': 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
  'Education': 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200',
  'Legal': 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200',
  'Finance': 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-200',
  'Technology': 'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200',
  'Recreation': 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
  'Community': 'bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200',
};

const badgeColor = categoryColors[category] || 'bg-neutral-100 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-200';
---

<article
  class="card group"
  data-category={category.toLowerCase()}
  data-groups={groups.join(',')}
  data-verified={verifiedBy ? 'true' : 'false'}
  id={`program-${id}`}
>
  <div class="flex flex-wrap items-start justify-between gap-2 mb-3">
    <div class="flex flex-wrap items-center gap-2">
      <span class={`badge ${badgeColor}`}>{category}</span>
      {verifiedBy && (
        <span class="inline-flex items-center gap-1 text-xs text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded-full" title={`Verified by ${verifiedBy}${verifiedDate ? ` on ${formatDate(verifiedDate)}` : ''}`}>
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          {verifiedBy}
        </span>
      )}
    </div>
    <span class="text-sm text-neutral-500 dark:text-neutral-400">{area}</span>
  </div>

  <h3 class="text-xl font-semibold text-neutral-900 dark:text-white mb-2 group-hover:text-primary-700 dark:group-hover:text-primary-300">
    {name}
  </h3>

  <p class="text-neutral-600 dark:text-neutral-300 mb-4">
    {description}
  </p>

  {whatTheyOffer && (
    <details class="mb-4">
      <summary class="cursor-pointer text-sm font-medium text-primary-700 dark:text-primary-300 hover:underline">
        What they offer
      </summary>
      <div class="mt-2 pl-4 text-sm text-neutral-600 dark:text-neutral-300 prose-width whitespace-pre-line">
        {whatTheyOffer}
      </div>
    </details>
  )}

  {howToGetIt && (
    <details class="mb-4">
      <summary class="cursor-pointer text-sm font-medium text-primary-700 dark:text-primary-300 hover:underline">
        How to get it
      </summary>
      <div class="mt-2 pl-4 text-sm text-neutral-600 dark:text-neutral-300">
        {howToGetIt}
      </div>
    </details>
  )}

  <div class="flex flex-wrap items-center gap-4 mt-auto pt-4 border-t border-neutral-100 dark:border-neutral-700">
    {link && (
      <a
        href={link}
        target="_blank"
        rel="noopener noreferrer"
        class="btn-primary text-sm"
      >
        {linkText}
        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
        </svg>
      </a>
    )}

    {phone && (
      <a
        href={`tel:${phone.replace(/\D/g, '')}`}
        class="inline-flex items-center text-sm text-neutral-600 dark:text-neutral-300 hover:text-primary-700 dark:hover:text-primary-300 no-underline"
      >
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
        </svg>
        {phone}
      </a>
    )}
  </div>
</article>
