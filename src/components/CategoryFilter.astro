---
interface Props {
  categories: string[];
}

const { categories } = Astro.props;
---

<div class="flex flex-wrap gap-2" role="group" aria-label="Filter by category">
  <button
    type="button"
    class="category-btn active"
    data-category="all"
    aria-pressed="true"
  >
    All
  </button>
  {categories.map((cat) => (
    <button
      type="button"
      class="category-btn"
      data-category={cat.toLowerCase()}
      aria-pressed="false"
    >
      {cat}
    </button>
  ))}
</div>

<style>
  .category-btn {
    @apply px-4 py-2 rounded-full text-sm font-medium
           bg-neutral-100 text-neutral-700
           hover:bg-neutral-200
           dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700
           transition-colors duration-150
           focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2;
  }

  .category-btn.active {
    @apply bg-primary-700 text-white hover:bg-primary-800
           dark:bg-primary-600 dark:hover:bg-primary-700;
  }
</style>

<script>
  const buttons = document.querySelectorAll('.category-btn');
  const cards = document.querySelectorAll('[data-category]');

  buttons.forEach((btn) => {
    btn.addEventListener('click', () => {
      // Update active state
      buttons.forEach((b) => {
        b.classList.remove('active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');

      // Filter cards
      const category = (btn as HTMLElement).dataset.category;

      cards.forEach((card) => {
        const cardCategory = (card as HTMLElement).dataset.category;
        const matches = category === 'all' || cardCategory === category;
        (card as HTMLElement).style.display = matches ? '' : 'none';
      });

      // Update count
      const visibleCount = document.querySelectorAll('[data-category]:not([style*="display: none"])').length;
      const counter = document.getElementById('results-count');
      if (counter) {
        counter.textContent = `${visibleCount} program${visibleCount !== 1 ? 's' : ''} found`;
      }
    });
  });
</script>
