<!-- College & University Student Programs Search & Filter UI -->
<!-- Place in _includes/college-filter-ui.html -->

<section class="search-panel" aria-label="Search and filter college programs">
  <div class="search-container">
    <!-- Search Bar -->
    <div class="search-field">
      <input
        type="search"
        id="college-search"
        class="table-search"
        placeholder="Search (food, transit, housing, stanford...)"
        aria-label="Search programs"
      />
      <span class="results-count" aria-live="polite" aria-atomic="true">
        <span class="result-number">0</span> programs
      </span>
    </div>

    <!-- Filter Section -->
    <div class="filters-section">
      <!-- Institution Type Filter -->
      <div class="filter-group">
        <label class="filter-group-label">Institution Type</label>
        <div class="filter-buttons" role="group" aria-label="Filter by institution type">
          <button class="filter-btn active" data-filter="type" data-value="all" aria-pressed="true">
            All
          </button>
          <button class="filter-btn" data-filter="type" data-value="community-college" aria-pressed="false">
            Community Colleges
          </button>
          <button class="filter-btn" data-filter="type" data-value="csu" aria-pressed="false">
            CSU
          </button>
          <button class="filter-btn" data-filter="type" data-value="uc" aria-pressed="false">
            UC
          </button>
          <button class="filter-btn" data-filter="type" data-value="private" aria-pressed="false">
            Private
          </button>
          <button class="filter-btn" data-filter="type" data-value="discount-platform" aria-pressed="false">
            Discount Platforms
          </button>
        </div>
      </div>

      <!-- Program Category Filter -->
      <div class="filter-group">
        <label class="filter-group-label">Program Type</label>
        <div class="filter-buttons" role="group" aria-label="Filter by program type">
          <button class="filter-btn active" data-filter="program-type" data-value="all" aria-pressed="true">
            All Programs
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="food" aria-pressed="false">
            ğŸ” Food
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="transit" aria-pressed="false">
            ğŸšŒ Transit
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="housing" aria-pressed="false">
            ğŸ  Housing
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="financial" aria-pressed="false">
            ğŸ’° Financial
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="technology" aria-pressed="false">
            ğŸ’» Technology
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="wellness" aria-pressed="false">
            ğŸƒ Wellness
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="emergency" aria-pressed="false">
            ğŸ†˜ Emergency
          </button>
          <button class="filter-btn" data-filter="program-type" data-value="discounts" aria-pressed="false">
            ğŸŸï¸ Discounts
          </button>
        </div>
      </div>

      <!-- Location Filter -->
      <div class="filter-group">
        <label class="filter-group-label">Location</label>
        <div class="filter-buttons" role="group" aria-label="Filter by location">
          <button class="filter-btn active" data-filter="location" data-value="all" aria-pressed="true">
            All Locations
          </button>
          <button class="filter-btn" data-filter="location" data-value="san-francisco" aria-pressed="false">
            San Francisco
          </button>
          <button class="filter-btn" data-filter="location" data-value="east-bay" aria-pressed="false">
            East Bay
          </button>
          <button class="filter-btn" data-filter="location" data-value="peninsula" aria-pressed="false">
            Peninsula
          </button>
          <button class="filter-btn" data-filter="location" data-value="south-bay" aria-pressed="false">
            South Bay
          </button>
          <button class="filter-btn" data-filter="location" data-value="north-bay" aria-pressed="false">
            North Bay
          </button>
          <button class="filter-btn" data-filter="location" data-value="marin" aria-pressed="false">
            Marin
          </button>
          <button class="filter-btn" data-filter="location" data-value="online" aria-pressed="false">
            Online
          </button>
        </div>
      </div>

      <!-- Reset Filters Button -->
      <button class="reset-btn" id="reset-filters" aria-label="Reset all filters">
        Reset Filters
      </button>
    </div>
  </div>
</section>

<script>
// College program search and filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('college-search');
  const filterButtons = document.querySelectorAll('[data-filter]');
  const resetButton = document.getElementById('reset-filters');
  const resultCount = document.querySelector('.result-number');
  const programCards = document.querySelectorAll('[data-program-card="true"]');

  console.log('Found ' + programCards.length + ' program cards');

  // Function to filter programs
  function filterPrograms() {
    const searchTerm = searchInput.value.toLowerCase();
    let visibleCount = 0;

    // Get active filters
    const activeFilters = {};
    filterButtons.forEach(btn => {
      if (btn.classList.contains('active') && btn.dataset.value !== 'all') {
        if (!activeFilters[btn.dataset.filter]) {
          activeFilters[btn.dataset.filter] = [];
        }
        activeFilters[btn.dataset.filter].push(btn.dataset.value);
      }
    });

    programCards.forEach(card => {
      let shouldShow = true;
      const cardTitle = (card.dataset.title || '').toLowerCase();
      const cardTags = (card.dataset.tags || '').split(',').map(t => t.trim().toLowerCase());
      const cardType = (card.dataset.type || '').toLowerCase();
      const cardLocation = (card.dataset.location || '').toLowerCase();
      const cardBenefit = (card.textContent || '').toLowerCase();

      // Search filter - checks title, tags, type, location, and visible text
      if (searchTerm) {
        const matchesSearch =
          cardTitle.includes(searchTerm) ||
          cardTags.some(tag => tag.includes(searchTerm)) ||
          cardType.includes(searchTerm) ||
          cardLocation.includes(searchTerm) ||
          cardBenefit.includes(searchTerm);
        if (!matchesSearch) shouldShow = false;
      }

      // Institution type filter (using data-type)
      if (shouldShow && activeFilters['type']) {
        if (!activeFilters['type'].includes(cardType)) {
          shouldShow = false;
        }
      }

      // Program type filter (using tags)
      if (shouldShow && activeFilters['program-type']) {
        const hasMatchingTag = activeFilters['program-type'].some(filter =>
          cardTags.includes(filter)
        );
        if (!hasMatchingTag) shouldShow = false;
      }

      // Location filter
      if (shouldShow && activeFilters['location']) {
        if (!activeFilters['location'].includes(cardLocation)) {
          shouldShow = false;
        }
      }

      card.style.display = shouldShow ? '' : 'none';
      if (shouldShow) visibleCount++;
    });

    // Update result count
    resultCount.textContent = visibleCount;
  }

  // Search input listener
  searchInput.addEventListener('input', filterPrograms);

  // Filter button listeners
  filterButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const filterType = this.dataset.filter;
      const filterValue = this.dataset.value;

      // Get all buttons of the same filter type
      const sameTypeButtons = document.querySelectorAll(`[data-filter="${filterType}"]`);
      
      // Reset siblings
      sameTypeButtons.forEach(sibling => {
        sibling.classList.remove('active');
        sibling.setAttribute('aria-pressed', 'false');
      });

      // Activate clicked button
      this.classList.add('active');
      this.setAttribute('aria-pressed', 'true');

      filterPrograms();
    });
  });

  // Reset filters
  resetButton.addEventListener('click', function() {
    // Reset all buttons to "all"
    filterButtons.forEach(btn => {
      if (btn.dataset.value === 'all') {
        btn.classList.add('active');
        btn.setAttribute('aria-pressed', 'true');
      } else {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
      }
    });

    // Clear search
    searchInput.value = '';
    filterPrograms();
  });

  // Initial filter on page load
  filterPrograms();
});
</script>
