<!-- Official Site Banner (usa.gov inspired) -->
<div class="official-banner">
  <div class="container">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M12 16v-4"></path>
      <path d="M12 8h.01"></path>
    </svg>
    <span>BayNavigator is a <strong>community-maintained</strong> resource for Bay Area residents</span>
  </div>
</div>

<header class="site-header">
  <h1 class="sr-only">Bay Navigator</h1>
  <div class="header-inner container">
    <a href="{{ site.baseurl | default: '' }}/?no-step=1" class="site-logo" aria-label="Bay Navigator - Home">
      <img src="{{ site.baseurl | default: '' }}/assets/images/logo/banner.svg" alt="Bay Navigator">
    </a>

    <nav class="site-nav" aria-label="Main navigation">
      <a href="{{ site.baseurl | default: '' }}/?no-step=1"
         class="nav-link"
         {% if page.url == '/' or page.url == '/index.html' %}aria-current="page"{% endif %}>
        All Programs
      </a>

      <a href="{{ site.baseurl | default: '' }}/about.html"
         class="nav-link"
         {% if page.url == '/about.html' %}aria-current="page"{% endif %}>
        About
      </a>

      <div class="nav-dropdown">
        <button class="nav-link nav-dropdown-toggle"
                type="button"
                aria-expanded="false"
                aria-haspopup="true"
                {% if page.url contains '/eligibility/' %}aria-current="page"{% endif %}>
          Eligibility Guides
          <span class="dropdown-arrow" aria-hidden="true">â–¾</span>
        </button>
        <ul class="nav-dropdown-menu" role="menu">
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/"
               role="menuitem"
               {% if page.url == '/eligibility/' or page.url == '/eligibility/index.html' %}aria-current="page"{% endif %}>
              All Guides
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/public-assistance.html"
               role="menuitem"
               {% if page.url == '/eligibility/public-assistance.html' %}aria-current="page"{% endif %}>
              Public Assistance
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/military-veterans.html"
               role="menuitem"
               {% if page.url == '/eligibility/military-veterans.html' %}aria-current="page"{% endif %}>
              Military &amp; Veterans
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/students.html"
               role="menuitem"
               {% if page.url == '/eligibility/students.html' %}aria-current="page"{% endif %}>
              Students
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/seniors.html"
               role="menuitem"
               {% if page.url == '/eligibility/seniors.html' %}aria-current="page"{% endif %}>
              Seniors
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/disability.html"
               role="menuitem"
               {% if page.url == '/eligibility/disability.html' %}aria-current="page"{% endif %}>
              Disability
            </a>
          </li>
          <li role="none">
            <a href="{{ site.baseurl | default: '' }}/eligibility/utility-programs.html"
               role="menuitem"
               {% if page.url == '/eligibility/utility-programs.html' %}aria-current="page"{% endif %}>
              Utility Programs
            </a>
          </li>
        </ul>
      </div>

      <a href="{{ site.baseurl | default: '' }}/favorites.html"
         class="nav-link"
         {% if page.url == '/favorites.html' %}aria-current="page"{% endif %}>
        Saved Programs
      </a>
    </nav>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const dropdownToggle = document.querySelector('.nav-dropdown-toggle');
  const dropdownMenu = document.querySelector('.nav-dropdown-menu');

  if (!dropdownToggle || !dropdownMenu) return;

  // Toggle dropdown on click
  dropdownToggle.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    const newState = !isExpanded;
    this.setAttribute('aria-expanded', newState ? 'true' : 'false');
    dropdownMenu.setAttribute('data-open', newState ? 'true' : 'false');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.nav-dropdown')) {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Keyboard navigation
  dropdownToggle.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      this.click();
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      const isExpanded = this.getAttribute('aria-expanded') === 'true';
      if (!isExpanded) {
        this.click();
      }
      const firstItem = dropdownMenu.querySelector('a');
      if (firstItem) firstItem.focus();
    } else if (e.key === 'Escape') {
      this.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Arrow key navigation within dropdown
  dropdownMenu.addEventListener('keydown', function(e) {
    const items = Array.from(this.querySelectorAll('a'));
    const currentIndex = items.indexOf(document.activeElement);

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const nextIndex = (currentIndex + 1) % items.length;
      items[nextIndex].focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const prevIndex = currentIndex <= 0 ? items.length - 1 : currentIndex - 1;
      items[prevIndex].focus();
    } else if (e.key === 'Escape') {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
      dropdownToggle.focus();
    } else if (e.key === 'Tab' && !e.shiftKey && currentIndex === items.length - 1) {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Close on focus out
  document.querySelector('.nav-dropdown').addEventListener('focusout', function(e) {
    setTimeout(() => {
      if (!this.contains(document.activeElement)) {
        dropdownToggle.setAttribute('aria-expanded', 'false');
        dropdownMenu.setAttribute('data-open', 'false');
      }
    }, 0);
  });
});
</script>
